workflows:
  ios-free-signing:
    name: iOS Free Developer Build
    max_build_duration: 60
    instance_type: mac_mini_m2
    environment:
      xcode: 15.2
      vars:
        APPLE_ID: Environ(APPLE_ID)
        APPLE_PASSWORD: Environ(APPLE_ID_PASSWORD)
        DEVELOPMENT_TEAM: ""
    scripts:
      - name: List schemes
        script: |
          echo "Listing schemes for PrimeraApp.xcodeproj"
          xcodebuild -project PrimeraApp.xcodeproj -list
      - name: Build unsigned .ipa
        script: |
          xcodebuild -project PrimeraApp.xcodeproj \
          -scheme Prueba22 \
          -sdk iphoneos \
          -configuration Release \
          -archivePath $CM_BUILD_DIR/Prueba22.xcarchive archive

          xcodebuild -exportArchive \
          -archivePath $CM_BUILD_DIR/Prueba22.xcarchive \
          -exportPath $CM_BUILD_DIR/ios \
          -exportOptionsPlist ExportOptions.plist
    artifacts:
      - $CM_BUILD_DIR/PrimeraApp.xcarchive/Products/Applications/PrimeraApp.app
      - $CM_BUILD_DIR/ios/*.ipa
    publishing:
      email:
        recipients:
          - mckdesarrollo@gmail.com
